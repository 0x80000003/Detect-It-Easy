function getVersion(){var e,t,r,i,o,E,d,n=PE.nLastSection,P=PE.section[n].FileOffset,$=PE.section[n].FileSize,n=(0==$&&(P=PE.section[n-1].FileOffset,$=PE.section[n-1].FileSize),PE.findSignature(P,$,"000000'ENIGMA'"))
return-1!=n?(e=PE.readByte(n+9),t=PE.readByte(n+10),r=PE.readWord(n+11),i=PE.readWord(n+13),o=PE.readWord(n+15),E=PE.readWord(n+17),d=PE.readWord(n+19),n=PE.readWord(n+21),sVersion=e+"."+t+" build "+r+"."+i+"."+o+" "+E+":"+d+":"+n,1):-1!=PE.findSignature(P,$,"'Enigma Protector'")&&(sVersion="5.X",!0)}function getVersion4x(){var e,t,r,i,o,E,d=PE.nLastSection,n=PE.section[d-1].FileOffset,d=PE.section[d-1].FileSize,n=PE.findSignature(n,d,"000000'ENIGMA'")
return-1!=n?(d=PE.readByte(n+9),e=PE.readByte(n+10),t=PE.readWord(n+11),r=PE.readWord(n+13),i=PE.readWord(n+15),o=PE.readWord(n+17),E=PE.readWord(n+19),n=PE.readWord(n+21),sVersion=d+"."+e+" build "+t+"."+r+"."+i+" "+o+":"+E+":"+n,1):0}function getVersion_old1x(){var e=PE.nLastSection
return-1!=PE.findSignature(PE.section[e].FileOffset,PE.section[e].FileSize,"'ENIGMA'07' PROT'")&&(sVersion="v1.14",!0)}function getVersion_old(){if(PE.section[".data"]){var e=PE.section[".data"].FileOffset
if(-1!=(e=PE.findString(e,PE.section[".data"].FileSize,"Enigma protector v")))return sVersion=PE.getString(e+18,4),!0}return!1}function detect(){if(!PE.isNet())return PE.is64()?(PE.compareEP("5051525355565741504151415241534154415541564157489C4881EC080000000FAE1C24E8000000005D")||PE.compareEP("eb$$60e8000000005d81ed........81ed........e9"))&&(getVersion(),bDetected=!0):PE.compareEP("558bec83c4..b8........e8........9a............e9$$$$$$$$60e8000000005d..ed")||PE.compareEP("60e8000000005d81ed........81ed........e9")||PE.compareEP("68........e8$$$$$$$$eb$$83c4..e9$$$$$$$$60e8000000005d81ed")||PE.compareEP("eb$$e9$$$$$$$$60e8000000005d81ed........81ed........e9")||PE.compareEP("e8$$$$$$$$83c4..e9$$$$$$$$60e8000000005d81ed........81ed........e9")?(getVersion(),bDetected=!0):PE.compareEP("60e8000000005d83....81ed")?(getVersion_old(),bDetected=!0):PE.compareEP("eb$$e9$$$$$$$$60e8000000005d83....81ed")&&(getVersion_old1x(),getVersion_old(),bDetected=!0),bDetected||(1<PE.getNumberOfImports()&&1==PE.getNumberOfImportThunks(1)&&"MessageBoxA"==PE.getImportFunctionName(1,0)&&3758096448==PE.getSectionCharacteristics(0)&&getVersion()||"enigma"==PE.getSectionNameCollision("1","2")||PE.isNet()&&PE.isSignatureInSectionPresent(0,"000000'ENIGMA'"))&&(bDetected=!0),PE.compareEP("60648b2d........3e8b6d..3e8b6d..e8........bb........c3")&&(getVersion4x(),bDetected=!0),result()}meta("protector","Enigma")
